$def with (user, item, outdated)
$ qitem = item.get_quality()
$ extra = item.optf2
$if not user:
    $ usern = "Schema"
$else:
    $ usern = user.get_persona() + "'s"
$var title: $project_name - $usern $extra["title_name"]
$def generate_class_icon_link(classes):
    $for ec in classes:
        <a href="${wiki_url + ec}">
          <img src="${static_prefix}${ec}_icon.png" title="$ec" alt="$ec"/>
        </a>&nbsp;
<div id="header">
  <h1 class="prefix-${qitem['str']}">
    $if not user:
        $ plink_user = "from_schema"
        $ urlpart = "schema_dump"
    $else:
        $ plink_user = user.get_id64()
        $ urlpart = "user/{0}".format(plink_user)
    <a href="${virtual_root}${urlpart}">$usern</a> $:extra["dedicated_name"]
  </h1>
</div>
<div id="content">
  <div id="item_stats" class="dedicated_item">
  <img class="item-image large" src="$extra['image_url_large']" alt="$usern $extra['title_name']"/>
  <img id="stat_vertrule" src="${static_prefix}vertical.gif" height="600" width="1" alt="divider"/>
  <div id="item_attrs">
  $ item_wiki_url = wiki_url + encode_url(item.get_name())
  <div class="item-level">
    Level $extra["level"] $extra["type"]
  </div>
  $if extra["description"]:
      <div class="item-description">
        $:extra["description"].replace("\n", "<br/>")
      </div>
  $for attr in extra["attrs"]:
      $ desc = attr.get_description_formatted()
      <div class="attr-${attr.get_type()}">
        $if "gift_from" in extra and attr.get_name() == "gifter account id":
            Gift from <a href="${virtual_root}user/${extra['gift_from']}">$extra["gift_from_persona"]</a>
        $elif "gift_content" in extra and attr.get_name() == "referenced item def":
            Contains <span class="prefix-${extra['gift_quality']}">$extra["gift_content"]</span>
            <a href="${virtual_root}item/${item.get_id()}?contents=1">(more)</a>
        $else:
            $:desc.replace("\n", "<br/>")
      </div>
  $if item.is_untradable():
      <div class="attr-neutral">
        Untradable
      </div>
  $if "paint_name" in item.optf2:
      <div class="attr-positive">
        $:{item.optf2["painted_text"]} with ${item.optf2["paint_name"]}
      </div>
  $if user:
      $ serial = item.get_id()
      $if "gift_from" in extra and not serial:
          <div class="attr-positive">
            Unopened <a href="${virtual_root}item/${extra['gift_container_id']}">Gift</a> from
            <a href="${virtual_root}user/${extra['gift_from']}">$extra["gift_from_persona"]</a>
          </div>
      $elif serial:
          <div class="attr-neutral">
            Serial: <span id="item_id">$serial</span>
          </div>
      <div class="attr-neutral">
        $ pos = item.get_position()
        Position: \
        $if pos <= -1:
            Not in backpack yet!
        $else:
            $pos
      </div>
      <div class="attr-neutral">
        $ equipped = item.get_equipped_classes()
        Equipped: \
        $if len(equipped) > 0:
            $:generate_class_icon_link(equipped)
        $else:
            No
      </div>
      $ quantity = item.get_quantity()
      $if quantity > 1:
          <div class="attr-neutral">
            Uses: $quantity
          </div>
      $if outdated:
          <div class="attr-negative" style="font-weight: normal">
            This item is out of date. It may have been deleted or customized.
          </div>
  $else:
      <div class="attr-neutral">
        $ schema_id = item.get_schema_id()
        ID: <span id="item_id">$schema_id</span>
      </div>
      <div class="attr-neutral">
        $ equipable = item.get_equipable_classes()
        Classes: \
        $if len(equipable) <= 0 or not equipable[0]:
            Not equipable
        $else:
            $:generate_class_icon_link(equipable)
      </div>
  <br/><a href="$item_wiki_url">Official TF Wiki Article</a>
  </div>
  </div>
</div>
