$def with (user, item, outdated)
$ qitem = item.get_quality()
$ extra = item.optf2
$ contents = extra.get("contents")
$if not user:
    $ usern = "Schema"
$else:
    $ usern = user.get_persona() + "'s"
$var title: $project_name - $usern $extra["title_name"]
$def generate_class_icon_link(classes):
    $for ec in classes:
        $if user:
            $ classlink = "{0}loadout/{1}#{2}".format(virtual_root, user.get_id64(), ec)
        $else:
            $ classlink = wiki_map[1] + ec
        <a href="$classlink"><img src="${static_prefix}${ec}_icon.png" title="$ec" alt="$ec"/></a>&nbsp;
<div id="header">
  <h1 class="prefix-${qitem['str']}">
    $if not user:
        $ plink_user = "from_schema"
        $ urlpart = "schema_dump"
    $else:
        $ plink_user = user.get_id64()
        $ urlpart = "user/{0}".format(plink_user)
    <a href="${virtual_root}${urlpart}">$usern</a> $:extra["dedicated_name"]
  </h1>
</div>
<div id="content">
  <div id="item_stats" class="dedicated_item">
    <div class="item-zoom">
      <img class="item-image large" src="$extra['image_url_large']" alt="$usern $extra['title_name']"/>
      $if 'particle-id' in extra:
          <img class="icon-particle large" src="${static_prefix}particle_icons/${extra['particle-id']}.png" alt="Picon"/>
    </div>
  <img class="stat_vertrule" src="${static_prefix}vertical.gif" height="100%" width="1" alt="divider"/>
  <div class="item-attrs">
  $ item_wiki_url = wiki_map[1] + encode_url(item.get_name())
  $:extra["level_string"]
  $if extra["description"]:
      <div class="item-description">
        $:extra["description"].replace("\n", "<br/>")
      </div>
  $for attr in extra["attrs"]:
      $ desc = attr.get_description_formatted()
      <div class="attr-${attr.get_type()}">
        $if "gifter_persona" in extra and attr.get_name() == "gifter account id":
            Gift from <a href="${virtual_root}user/${extra['gifter_id']}">$extra["gifter_persona"]</a>
        $elif contents and attr.get_name() == "referenced item def":
            $:extra["content_string"] <a href="$qurl(contents = 1)">(more)</a>
        $elif "crafted_by_id64" in extra and attr.get_name() == "makers mark id":
            Crafted by <a href="${virtual_root}user/${extra['crafted_by_id64']}">$extra['crafted_by_persona']</a>
        $else:
            $:desc.replace("\n", "<br/>")
      </div>
  $if "kill_count" in extra:
      <div class="attr-positive">$extra["kill_type"]: $extra["kill_count"]</div>
  $if "kill_count_2" in extra:
      <div class="attr-positive">$extra["kill_type_2"]: $extra["kill_count_2"]</div>
  $ craft_no = extra.get("craft_number")
  $if craft_no and item.get_custom_name():
      <div class="attr-positive">Craft number: $craft_no</div>
  $ style = item.get_current_style_name()
  $if style: <div class="attr-neutral">Style: $style</div>
  $ quantity = item.get_quantity()
  $if quantity > 1:
      <div class="attr-neutral">
        Uses: $quantity
      </div>
  $if item.is_untradable():
      $if "date_tradable" in extra:
          <div class="attr-neutral">Tradable after: $extra["date_tradable"]</div>
      $else:
          <div class="attr-neutral">Untradable</div>

  <img src="${static_prefix}vertical.gif" height="1" width="100%" alt="divider"/>

  $if "paint_name" in extra:
      <div class="attr-positive">
        $:{extra["painted_text"]} with ${extra["paint_name"]}
      </div>
  $if user:
      $ serial = item.get_id()
      $if "container_id" in extra and not serial:
          <div class="attr-positive">
            Unopened <a href="${virtual_root}item/${extra['container_id']}">Gift</a> from
            <a href="${virtual_root}user/${extra['gifter_id']}">$extra["gifter_persona"]</a>
          </div>
      $elif serial:
          <div class="attr-neutral">
            Serial: <span id="item_id">$serial</span>
          </div>
      <div class="attr-neutral">
        $ pos = item.get_position()
        Position: \
        $if pos <= -1:
            Not in backpack yet!
        $else:
            $pos
      </div>
      <div class="attr-neutral">
        $ equipped = item.get_equipped_classes()
        Equipped: \
        $if len(equipped) > 0:
            $:generate_class_icon_link(equipped)
        $else:
            No
      </div>
      $if outdated:
          <div class="attr-negative" style="font-weight: normal">
            This item is out of date. It may have been deleted or customized.
          </div>
  $else:
      <div class="attr-neutral">
        ID: <span id="item_id">$item.get_schema_id()</span>
      </div>
      <div class="attr-neutral">
        $ equipable = item.get_equipable_classes()
        Classes: \
        $if len(equipable) <= 0 or not equipable[0]:
            Not equipable
        $else:
            $:generate_class_icon_link(equipable)
      </div>
      $ styles = item.get_styles()
      $if styles: <div class="attr-neutral">Styles: ${", ".join(styles)}</div>
      $ slot = item.get_slot()
      $if slot:
          <div class="attr-neutral">
            Slot: $slot.title()
          </div>
      $if "capabilities" in extra:
          <ul class="capability-list">
            <lh>Capabilities</lh>
            $for cap in extra["capabilities"]:
                <li style="padding: 2px 0 2px 0;">$cap</li>
          </ul>
  <ul class="button-list">
    <li><a class="button" href="$item_wiki_url">$wiki_map[0] article</a></li>
  $if user:
      <li><a class="button" href="${virtual_root}item/${item.get_schema_id()}">Schema version</a></li>
  </ul>
  </div>
  </div>
</div>
