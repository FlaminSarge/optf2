$def with (user, item, outdated, price = None)
$ qitem = item.get_quality()
$ extra = item.optf2
$ current_wiki = wiki_map.get(instance.current_game)
$if not user:
    $ usern = "Schema"
$else:
    $ usern = user.get_persona() + "'s"
$var title: $project_name - $usern $extra["title_name"]
$def generate_class_icon_link(classes):
    $ classlink = '#'
    $for ec in classes:
        $if user:
            $ classlink = markup.generate_mode_url("loadout/{0}#{1}".format(user.get_id64(), ec))
        $else:
            $if current_wiki:
                $ classlink = current_wiki[1] + ec
        <a href="$classlink"><img src="${static_prefix}${ec}_icon.png" title="$ec" alt="$ec"/></a>&nbsp;
<div id="header">
  $ style = ""
  $if "namecolor" in item.optf2: $ style = ' style="color: #{0};"'.format(item.optf2["namecolor"])
  <h1 class="prefix-$qitem['str']"$:style>
    $if not user:
        $ plink_user = "from_schema"
        $ urlpart = "items"
    $else:
        $ plink_user = user.get_id64()
        $ urlpart = "user/{0}".format(plink_user)
    <a href="$markup.generate_mode_url(urlpart)">$usern</a> $:extra["dedicated_name"]
  </h1>
</div>
<div id="content">
  <div id="item_stats" class="dedicated_item">
    <div class="item-zoom">
      <img class="item-image large" src="$extra['image_url_large']" alt="$usern $extra['title_name']"/>
      $if 'particle-id' in extra:
          <img class="icon-particle large" src="${static_prefix}particle_icons/${extra['particle-id']}.png" alt="Picon"/>
      $if 'custom texture' in extra:
	  <img class="icon-custom-texture large" src="$extra['custom texture']" alt="texture"/>
    </div>
  <img class="stat_vertrule" src="${static_prefix}vertical.gif" height="100%" width="1" alt="divider"/>
  <div class="item-attrs">
  $ item_wiki_url = None
  $if current_wiki:
      $ item_wiki_url = current_wiki[1] + encode_url(item.get_name())
  $:markup.generate_item_type_line(item)

  $:markup.generate_item_description(item)

  $:markup.generate_attribute_list(item, showlinks = True)

  <img src="${static_prefix}vertical.gif" height="1" width="100%" alt="divider"/>

  <ul class="attribute-list">
    $:markup.generate_item_paint_line(item)
  $if user:
      $ serial = item.get_id()
      $if "container_id" in extra and not serial:
          <li class="attr-positive">
            Unopened <a href="$markup.generate_mode_url('item/{0}/{1}'.format(user.get_id64(), extra['container_id']))">Gift</a> from
	    $ giftgiver = extra.get("gift")
	    $if giftgiver:
                <a href="$markup.generate_mode_url('user/{0}'.format(giftgiver["id64"]))">$giftgiver["persona"]</a>
          </li>
      $elif serial:
	  $ oserial = item.get_original_id()
          <li class="attr-neutral">ID: <span id="item_id">$serial</span></li>
	  $if oserial and oserial != serial:
	      <li class="attr-neutral">Last ID: $oserial</li>
      <li class="attr-neutral">
        $ pos = item.get_position()
        Position: \
        $if pos <= -1:
            Not in backpack yet!
        $else:
            $pos
      </li>
      <li class="attr-neutral">
        $ equipped = item.get_equipped_classes()
        Equipped: \
        $if len(equipped) > 0:
            $:generate_class_icon_link(equipped)
        $else:
            No
      </li>
      $if outdated:
          <li class="attr-negative" style="font-weight: normal">
            This item is out of date. It may have been deleted or customized.
          </li>
  $else:
      <li class="attr-neutral">
        ID: <span id="item_id">$item.get_schema_id()</span>
      </li>
      <li class="attr-neutral">
        $ equipable = item.get_equipable_classes()
        Classes: \
        $if len(equipable) <= 0 or not equipable[0]:
            Not equipable
        $else:
            $:generate_class_icon_link(equipable)
      </li>
      $ styles = item.get_styles()
      $if styles: <li class="attr-neutral">Styles: ${", ".join(styles)}</li>
      $ slot = item.get_slot()
      $if slot:
          <li class="attr-neutral">Slot: $slot.title()</li>
      $if price: <li class="attr-neutral">$price</li>
  </ul>
  $if "capabilities" in extra:
      <ul class="capability-list">
        <li>Capabilities</li>
        $for cap in extra["capabilities"]:
            <li style="padding: 2px 0 2px 0;">$cap</li>
      </ul>
  <ul class="button-list">
    $if item_wiki_url:
        <li><a class="button" href="$item_wiki_url">$current_wiki[0] article</a></li>
    $if user:
        <li><a class="button" href="$markup.generate_mode_url('item/{0}'.format(item.get_schema_id()))">Schema version</a></li>
  </ul>
  </div>
  </div>
</div>
