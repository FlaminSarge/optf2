$def with (user, pack, isvalve, items)
$ usern = user.get_persona()
$ realn = user.get_real_name()
$var title: $product_name - $usern's Backpack
$ perma = "{0}user/{1}".format(virtual_root, user.get_id64())
$ rss = "{0}feed/{1}".format(virtual_root, user.get_id64())
<div id="header">
  $ cgame = user.get_current_game()
  $ cstatus = user.get_status()
  $if isvalve:
      $ name_suffix = '<img src="{0}valve.png" alt="Valve" title="Valve Employee"/>'.format(static_prefix)
  $else: $ name_suffix = ''
  <div id="avatar">
    <img src="$user.get_avatar_url(user.AVATAR_LARGE)" alt="$realn" title="$realn"/><br/>
    <b>$realn &nbsp;$:name_suffix</b>
  </div>
  <div id="status_$cstatus">
    $if cgame:
        Playing \
        $ game_extra = cgame.get("extra", "Unknown")
        $ game_server = cgame.get("server", "0.0.0.0:0")
        $if cgame.has_key("id"):
            <a href="http://store.steampowered.com/app/$cgame['id']">$game_extra</a>
        $else:
            $game_extra
        $if game_server != "0.0.0.0:0":
            <a href="steam://connect/$game_server">(Connect)</a>
    $else:
        $cstatus
  </div>
  <h2><a href="$user.get_profile_url()">$usern's</a>
  Backpack
  $if len(items) <= 0:
      &nbsp;is empty!
  <a href="$perma" rel="bookmark"><img src="${static_prefix}plink_icon.png" alt="Permalink" title="Permalink"/></a>
  <a href="$rss"><img src="${static_prefix}feed_icon.png" alt="RSS" title="Subscribe to an RSS feed of this backpack"/></a>
  </h2>
  $if len(items) > 0:
        <a href="$perma?sort=default">Default</a>
      | <a href="$perma?sort=serial">Serial</a>
      | <a href="$perma?sort=cell">Position</a>
      | <a href="$perma?sort=level">Level</a>
      | <a href="$perma?sort=name">Name</a>
      | <a href="$perma?sort=slot">Type</a>
      | <a href="$perma?sort=class">Class</a>
</div>
<div id="content">
  <div id="backpack">
  $for item in items:
      $ qitem = pack.get_item_quality(item)["str"]
      $ item_link = virtual_root + "item/%lu/%lu" % (user.get_id64(), pack.get_item_id(item))
      $ item_id = pack.get_item_id(item)
      $if pack.get_item_position(item) <= -1:
          $ cell_class = "item_cell_undropped"
      $else:
          $ cell_class = "item_cell"
      <div class="$cell_class" id="$item_id" onclick="item_open('${item_link}', '$item_id');">
        $ full_name = pack.get_item_custom_name(item)
        $if not full_name:
            $ full_name = qualitydict.get(qitem, "") + " " + pack.get_item_name(item)
        <div class="${qitem}_name">$full_name</div>
        $ item_color = item.get("optf2_color")
        $if item_color:
            $ painty = '<span style="color: {0}; font-weight: bold;">Painted</span>'.format(item_color)
        $else:
            $ painty = ""
        <div class="item_level">Level $pack.get_item_level(item) $:painty $pack.get_item_type(item)</div>
        <a class="item_link" href="$item_link">
          <img class="item_image_small" src="$pack.get_item_image(item, pack.ITEM_IMAGE_SMALL)" alt="$pack.get_item_name(item)"/>
        </a>
        <div class="item_attribs">
          $for attr in item["optf2_attrs"]:
              <div class="item_${pack.get_attribute_type(attr)}_attr">
                $:pack.format_attribute_description(attr)
              </div>
        </div>
      </div>
  </div>
</div>
<div id="footer">
  Valve says I should link to <a href="http://steampowered.com">this</a>.
</div>
