$def with (user, pack, sortby)
$ items = pack.get_items()
$ usern = user.get_persona()
$ realn = user.get_real_name()
$ qualitydict = {"unique": "The ", "community": "Community ",
$                "developer": "Legendary ", "normal": "",
$                "selfmade": "My "}
$var title: Steamodd - $usern's Backpack
$ perma = virtual_root + "user/%lu" % user.get_id64()
<div id="header">
  $ cgame = user.get_current_game()
  $ cstatus = user.get_status()
  <div id="avatar">
    <img src="$user.get_avatar_url(user.AVATAR_LARGE)" alt="$realn" title="$realn"/><br/>
    <b>$realn</b>
  </div>
  <div id="status_$cstatus">
    $if cgame:
        Playing \
        $if cgame.has_key("id"):
            <a href="http://store.steampowered.com/app/$cgame['id']">$cgame["extra"]</a>
        $else:
            $cgame["extra"]
        $if cgame.has_key("server") and cgame["server"] != "0.0.0.0:0":
            <a href="steam://connect/$cgame['server']">(Connect)</a>
    $else:
        $cstatus
  </div>
  <h2><a href="$user.get_profile_url()">$usern's</a>
  Backpack
  $if len(items) <= 0:
      &nbsp;is empty!
  </h2>
  <i id="plink"><a href="$perma" rel="bookmark">(permalink)</a></i>
  $if len(items) > 0:
        <a href="$perma?sort=serial">Serial</a>
      | <a href="$perma?sort=cell">Position</a>
      | <a href="$perma?sort=level">Level</a>
      | <a href="$perma?sort=name">Name</a>
      | <a href="$perma?sort=slot">Type</a>
      | <a href="$perma?sort=class">Class</a>
</div>
$code:
    itemcmp = None
    def defcmp(x, y):
        if x < y:
            return -1
        elif x > y:
            return 1
        elif x == y:
            return 0

    if sortby == "serial":
        def itemcmp(x, y):
            return defcmp(pack.get_item_id(x),
                          pack.get_item_id(y))
    elif sortby == "cell":
        def itemcmp(x, y):
            return defcmp(pack.get_item_position(x),
                          pack.get_item_position(y))
    elif sortby == "level":
        def itemcmp(x, y):
            return defcmp(pack.get_item_level(x),
                          pack.get_item_level(y))
    elif sortby == "name":
        def itemcmp(x, y):
            return defcmp(pack.get_item_quality(x)["str"] + " " + pack.get_item_name(x),
                          pack.get_item_quality(y)["str"] + " " + pack.get_item_name(y))
    elif sortby == "slot":
        def itemcmp(x, y):
            return defcmp(pack.get_item_slot(x), pack.get_item_slot(y))
    elif sortby == "class":
        def itemcmp(x, y):
            cx = pack.get_item_equipable_classes(x)
            cy = pack.get_item_equipable_classes(y)
            lenx = len(cx)
            leny = len(cy)

            if lenx == 1 and leny == 1:
                return defcmp(cx[0], cy[0])
            else:
                return defcmp(lenx, leny)
                    
    if itemcmp:
        items.sort(cmp = itemcmp)
<div id="content">
  $for item in items:
      $ qitem = pack.get_item_quality(item)["str"]
      $ pos = pack.get_item_position(item)
      $if pos <= -1:
          <!-- Eww, style attribute. -->
          <div id="item_cell" style="border-color: red;">
      $else:
          <div id="item_cell">
        <div class="${qitem}_name">$qualitydict[qitem] $pack.get_item_name(item)</div>
        <div class="item_level">Level $pack.get_item_level(item) $pack.get_item_type(item)</div>
        <img src="$pack.get_item_image(item, pack.ITEM_IMAGE_SMALL)" alt="$pack.get_item_name(item)"/>
        <div id="item_attribs">
          $for attr in pack.get_item_attributes(item):
              $ desc = pack.format_attribute_description(attr)
              $if desc.find("Attrib_") == -1:
                  <div class="item_${pack.get_attribute_type(attr)}_attr">
                    $if desc.find("\n") != -1:
                        $:desc.replace("\n", "<br/>")
                    $else:
                        $desc
                  </div>
          <div class="item_neutral_attr">
            Serial Number: $pack.get_item_id(item)
          </div>
          <div class="item_neutral_attr">
            $if pos <= -1:
                Not in backpack yet!
            $else:
                Pack cell: $pos
          </div>
          <div class="item_neutral_attr">
            $ equipped = pack.get_item_equipped_classes(item)
            $ equipable = pack.get_item_equipable_classes(item)

            In use by:<br/>
            $for ec in equipable:
                $if ec in equipped:
                    <div class="class_equipped">$ec</div>
                $else:
                    <div class="class_unequipped">$ec</div>
          </div>
        </div>
      </div>
</div>
<div id="footer">
  Valve says I should link to <a href="http://steampowered.com"/>this</a>.
</div>
